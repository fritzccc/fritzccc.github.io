---
title: S3文件桶上传文件小记'
date: 2018-08-08 21:52:33
categories: 
- Frontend
tags:
- relo
- AWS S3
- Vue
- axios
---

这阵子做的vue项目里要求拖拽上传文件到AWS S3储存桶。网上差了长，说是new一个FormData封装起来就之后，然后用axios等http请求工具上传即可，二话不说，马上试了试。



<!--more-->



这里是示例的HTML部分 (拖拽部分省了)

```html
<div id="app">
    <img src="./assets/logo.png">
    <div>
      <input type="file" id="file"/>
      <el-button @click="upload">upload</el-button>
    </div>
  </div>
```



以下是`methods`中的`upload()`部分

```javascript
let file=document.getElementById("file").files[0];
let fd=new FormData();
fd.append('file',file);
let url='http://httpbin.org/put';
this.$http.put(url,fd,{})	//{}=>config
    .then(res=>{
    console.log('upload -> res', res); 
})
```



So Easy！马上试了试！结果`res`的`files`内容为

```json
files:{}
```

什么鬼？我的文件呢？



然后各种查，各种折腾，好多说设置 `axios.put` 中的 `headers` ，然并卵，之后事实也表明设置不设置都是无关紧要的



走投无路之际，我在本地新建了一个html文档，引入jQuery和axios做测试，上传，成功了！细细对比，发现代码几乎一致，唯一的区别就是本地的html文档是CDN在线引入 ( scripts 标签 )，而项目中是直接`import axios from ‘axios’`

于是尝试在项目的`index.html`文件下直接通过scripts标签引入CDN，测试上传，真的成功了我去...

行吧，直接下载`axios.min.js`文件，然后在`main.js`中

```javascript
const {axios} = require('相对路径/axios.min.js');
Vue.prototype.$http = axios;
```

搞定！向 httpbin.org/put 上传成功！



**后记：**

向S3上传文件看来不需要用FormData包起来，包起来反而会出错

如下即可

```javascript
let file=document.getElementById("file").files[0];
let url='http://httpbin.org/put';
this.$http.put(url,file,{})	//{}=>config
    .then(res=>{
    console.log('upload -> res', res); 
})
```
